{"remainingRequest":"C:\\Users\\小没没\\Desktop\\cxl\\runboo01\\frontend-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\小没没\\Desktop\\cxl\\runboo01\\frontend-web\\src\\components\\Upload\\FileUpload.vue?vue&type=style&index=0&id=93608bea&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\小没没\\Desktop\\cxl\\runboo01\\frontend-web\\src\\components\\Upload\\FileUpload.vue","mtime":1601014008295},{"path":"C:\\Users\\小没没\\Desktop\\cxl\\runboo01\\frontend-web\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"C:\\Users\\小没没\\Desktop\\cxl\\runboo01\\frontend-web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\小没没\\Desktop\\cxl\\runboo01\\frontend-web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\小没没\\Desktop\\cxl\\runboo01\\frontend-web\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\小没没\\Desktop\\cxl\\runboo01\\frontend-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\小没没\\Desktop\\cxl\\runboo01\\frontend-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import \"@/styles/mixin.scss\";\n.upload-container {\n    width: 100%;\n    position: relative;\n    @include clearfix;\n    .image-uploader {\n        width: 60%;\n        float: left;\n    }\n}\n\n",{"version":3,"sources":["FileUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FileUpload.vue","sourceRoot":"src/components/Upload","sourcesContent":["<template>\n  <div class=\"upload-container\">\n    <ul v-if=\"fileListChild.length>0\" class=\"uploadShow\" :show-id=\"ztSort\">\n      <li v-for=\"(item,i) in fileListChild\" :key=\"i\">\n        <span class=\"fr ml10\" style=\"cursor: pointer\" @click=\"delWj(item)\"><img src=\"@/icons/img/close.png\" height=\"12\" width=\"12\"></span>\n        <span v-if=\"item.type=='pic'\"><img src=\"@/icons/img/pic.png\" height=\"16\" width=\"14\"></span>\n        <span v-else-if=\"item.type=='audio'\"><img src=\"@/icons/img/audio.png\" height=\"16\" width=\"14\"></span>\n        <span v-else-if=\"item.type=='video'\"><img src=\"@/icons/img/video.png\" height=\"16\" width=\"14\"></span>\n        <span v-else><img src=\"@/icons/img/wd.png\" height=\"16\" width=\"14\"></span>\n        <span>{{ item.name }}</span>\n      </li>\n    </ul>\n    <el-upload\n      ref=\"upload\"\n      class=\"upload-demo fr\"\n      action=\"action\"\n      :auto-upload=\"false\"\n      :on-change=\"handleChange\"\n      :on-remove=\"handleRemove\"\n      :show-file-list=\"false\"\n      :on-success=\"handleSuccess\"\n      :before-upload=\"beforeUpload\"\n      multiple\n      :limit=\"3\"\n      :on-exceed=\"handleExceed\"\n      accept=\".pdf,.doc,.docx,.jpg\"\n    >\n      <el-button type=\"text\" class=\"fr\">上传文件</el-button>\n    </el-upload>\n  </div>\n</template>\n\n<script>\n\nexport default {\n  name: 'FileUpload',\n  props: {\n    value: {\n      type: String,\n      default: ''\n    },\n    ztSort: {\n      type: String,\n      default: ''\n    },\n    file: {\n      type: Array,\n      required: true\n    },\n    fileList: {\n      type: Array,\n      required: true\n    }\n  },\n  data() {\n    return {\n      fileIdList: [],\n      fileListSave: [],\n      uploadSucess: false,\n      fileListChild: [],\n      fileEditor: []\n    }\n  },\n  watch: {\n    fileList(newVal) {\n      if (newVal.length > 0) {\n        this.fileListChild = newVal\n      }\n    }\n  },\n  methods: {\n    handleExceed(files, fileList) {\n      this.$message.warning('请最多上传 ${this.limit} 个文件')\n    },\n    beforeUpload(file) {\n      // const isLt2M = file.size / 1024 / 1024 < 100\n      // if (!isLt2M) {\n      //   this.$message({\n      //     message: '上传文件大小不能超过 100MB!',\n      //     type: 'warning'\n      //   })\n      // }\n      const formDatas = new FormData()\n      formDatas.append('file', file)\n      this.$api.upload(formDatas).then(res => {\n        this.uploadSucess = true\n        this.fileIdList.push({ id: res.data })\n        if (this.ztSort) {\n          this.file.push(res.data)\n          // 将数组转换成对象数组\n          const arrList = []\n          for (const i in this.file) {\n            var j = {}\n            j.id = this.file[i]\n            arrList.push(j)\n          }\n          const obj = this.fileListChild.map((item, index) => {\n            return { ...item, ... arrList[index] }\n          })\n          this.fileListChild = obj\n          this.$emit('uploadFile', this.file)\n        } else {\n          this.fileListSave.push(res.data)\n          const obj = this.fileListChild.map((item, index) => {\n            return { ...item, ... this.fileIdList[index] }\n          })\n          this.fileListChild = obj\n          this.$emit('uploadFile', this.fileListSave)\n        }\n      })\n      return false\n    },\n    // 上传\n    handleChange(file) {\n      if (file.status === 'ready') {\n        const formDatas = new FormData()\n        formDatas.append('file', file)\n        const dataType = file.name\n        const types = dataType.substring(dataType.lastIndexOf('.') + 1)\n        let type = ''\n        if (types === 'jpg' || types === 'png' || types === 'jpeg' || types === 'gif' || types === 'psd') {\n          type = 'pic'\n        } else if (types === 'mp4' || types === 'avi' || types === 'wmv' || types === 'rm' || types === 'swf' || types === 'flv') {\n          type = 'video'\n        } else if (types === 'mp3' || types === 'wav' || types === 'ogg' || types === 'm4a') {\n          type = 'audio'\n        } else {\n          type = 'wx'\n        }\n        this.$set(file, 'type', type)\n        // 判断是否已经存在此文件\n        var ret2 = this.fileListChild.findIndex((v) => {\n          return v.name === file.name\n        })\n        if (ret2 !== -1) {\n          this.$message.error('文件已上传')\n          return\n        }\n        if (this.fileListChild.length > 2) {\n          this.$message.error('最多上传3个文件')\n          return false\n        }\n        this.fileListChild.push(file)\n        let sum = 0\n        this.fileListChild.forEach(function(item, index) {\n          if (item.size) {\n            sum = sum + item.size\n          }\n        })\n        const isLt2M = sum / 1024 / 1024 < 100\n        if (!isLt2M) {\n          this.$message({\n            message: '上传文件大小不能超过 100MB!',\n            type: 'warning'\n          })\n          return false\n        }\n        this.$refs.upload.submit()\n      }\n    },\n    handleSuccess(res) {\n\n    },\n    delWj(obj) {\n      this.fileListChild = this.fileListChild.filter(function(item) {\n        return item.name !== obj.name\n      })\n      this.$api.delFile({ id: obj.id }).then(response => {\n        if (response.code === 200) {\n          this.fileListChild = this.fileListChild.filter(item => item.id !== obj.id)\n          if (this.ztSort) {\n            this.fileEditor = this.file\n            this.fileEditor = this.fileEditor.filter(item => item !== obj.id)\n            this.$emit('uploadFile', this.fileEditor)\n          } else {\n            this.fileListSave = this.fileListSave.filter(item => item !== obj.id)\n            this.$emit('uploadFile', this.fileListSave)\n          }\n          this.uploadSucess = true\n        } else {\n          this.$message({\n            message: response.message,\n            type: 'warning'\n          })\n        }\n      })\n    },\n    handleRemove(file, fileList) {\n      // this.$emit('input', file)\n      // 处理 before-upload验证不通过后触发了on-remove的解决办法\n      if (file && file.status === 'success') {\n        return this.$confirm('你确定删除这个文件？')\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n    @import \"@/styles/mixin.scss\";\n    .upload-container {\n        width: 100%;\n        position: relative;\n        @include clearfix;\n        .image-uploader {\n            width: 60%;\n            float: left;\n        }\n    }\n\n</style>\n"]}]}