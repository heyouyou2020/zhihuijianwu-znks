{"remainingRequest":"C:\\Users\\小没没\\Desktop\\zhihuiks\\lvshipingtai\\frontend-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\小没没\\Desktop\\zhihuiks\\lvshipingtai\\frontend-web\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\小没没\\Desktop\\zhihuiks\\lvshipingtai\\frontend-web\\src\\store\\modules\\user.js","dependencies":[{"path":"C:\\Users\\小没没\\Desktop\\zhihuiks\\lvshipingtai\\frontend-web\\src\\store\\modules\\user.js","mtime":1601027517472},{"path":"C:\\Users\\小没没\\Desktop\\zhihuiks\\lvshipingtai\\frontend-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\小没没\\Desktop\\zhihuiks\\lvshipingtai\\frontend-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\小没没\\Desktop\\zhihuiks\\lvshipingtai\\frontend-web\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"C:/Users/\\u5C0F\\u6CA1\\u6CA1/Desktop/zhihuiks/lvshipingtai/frontend-web/node_modules/@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"C:/Users/\\u5C0F\\u6CA1\\u6CA1/Desktop/zhihuiks/lvshipingtai/frontend-web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"C:/Users/\\u5C0F\\u6CA1\\u6CA1/Desktop/zhihuiks/lvshipingtai/frontend-web/node_modules/@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _user = require(\"@/api/user\");\n\nvar _auth = require(\"@/utils/auth\");\n\nvar _router = _interopRequireWildcard(require(\"@/router\"));\n\nvar state = {\n  token: (0, _auth.getToken)(),\n  name: '',\n  avatar: '',\n  introduction: '',\n  roles: [{\n    name: 'admin'\n  }],\n  userInfo: '',\n  menuList: []\n};\nvar mutations = {\n  SET_TOKEN: function SET_TOKEN(state, token) {\n    state.token = token;\n  },\n  SET_INTRODUCTION: function SET_INTRODUCTION(state, introduction) {\n    state.introduction = introduction;\n  },\n  SET_NAME: function SET_NAME(state, name) {\n    state.name = name;\n  },\n  SET_AVATAR: function SET_AVATAR(state, avatar) {\n    state.avatar = avatar;\n  },\n  SET_ROLES: function SET_ROLES(state, roles) {\n    state.roles = roles;\n  },\n  SET_USERINFO: function SET_USERINFO(state, userInfo) {\n    state.userInfo = userInfo;\n  },\n  SET_MENULIST: function SET_MENULIST(state, menuList) {\n    state.menuList = menuList;\n  }\n};\nvar actions = {\n  // user login\n  login: function login(_ref, userInfo) {\n    var commit = _ref.commit;\n    var dlbm = userInfo.dlbm,\n        password = userInfo.password,\n        dwbm = userInfo.dwbm;\n    return new Promise(function (resolve, reject) {\n      (0, _user.login)({\n        dlbm: dlbm.trim(),\n        password: password,\n        dwbm: dwbm\n      }).then(function (response) {\n        var data = response.data;\n        debugger;\n        console.log(data);\n        commit('SET_TOKEN', data.token);\n        commit('SET_USERINFO', data.user);\n        (0, _auth.setToken)(data.token);\n        (0, _auth.setUserId)(data.user.id);\n        resolve();\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  // get user menu\n  getMenu: function getMenu(_ref2) {\n    var commit = _ref2.commit,\n        state = _ref2.state;\n    return new Promise(function (resolve, reject) {\n      var params = {\n        userid: state.userInfo && state.userInfo.id\n      };\n      (0, _user.getUserMenuList)(params).then(function (response) {\n        debugger;\n        var data = response.data;\n        commit('SET_MENULIST', data);\n        resolve(data);\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  // user logout\n  logout: function logout(_ref3) {\n    var commit = _ref3.commit,\n        state = _ref3.state,\n        dispatch = _ref3.dispatch;\n    return new Promise(function (resolve, reject) {\n      try {\n        commit('SET_TOKEN', '');\n        commit('SET_ROLES', []);\n        (0, _auth.removeToken)();\n        (0, _router.resetRouter)();\n        resolve();\n      } catch (e) {\n        reject(e);\n      }\n    });\n  },\n  // remove token\n  resetToken: function resetToken(_ref4) {\n    var commit = _ref4.commit;\n    return new Promise(function (resolve) {\n      commit('SET_TOKEN', '');\n      commit('SET_ROLES', []);\n      (0, _auth.removeToken)();\n      resolve();\n    });\n  },\n  // dynamically modify permissions\n  changeRoles: function changeRoles(_ref5, role) {\n    var commit = _ref5.commit,\n        dispatch = _ref5.dispatch;\n    return new Promise( /*#__PURE__*/function () {\n      var _ref6 = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee(resolve) {\n        var token, _yield$dispatch, roles, accessRoutes;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                token = role + '-token';\n                commit('SET_TOKEN', token);\n                (0, _auth.setToken)(token);\n                _context.next = 5;\n                return dispatch('getInfo');\n\n              case 5:\n                _yield$dispatch = _context.sent;\n                roles = _yield$dispatch.roles;\n                (0, _router.resetRouter)(); // generate accessible routes map based on roles\n\n                _context.next = 10;\n                return dispatch('permission/generateRoutes', roles, {\n                  root: true\n                });\n\n              case 10:\n                accessRoutes = _context.sent;\n\n                // dynamically add accessible routes\n                _router.default.addRoutes(accessRoutes); // reset visited views and cached views\n\n\n                dispatch('tagsView/delAllViews', null, {\n                  root: true\n                });\n                resolve();\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref6.apply(this, arguments);\n      };\n    }());\n  }\n};\nvar _default = {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};\nexports.default = _default;",{"version":3,"sources":["C:/Users/小没没/Desktop/zhihuiks/lvshipingtai/frontend-web/src/store/modules/user.js"],"names":["state","token","name","avatar","introduction","roles","userInfo","menuList","mutations","SET_TOKEN","SET_INTRODUCTION","SET_NAME","SET_AVATAR","SET_ROLES","SET_USERINFO","SET_MENULIST","actions","login","commit","dlbm","password","dwbm","Promise","resolve","reject","trim","then","response","data","console","log","user","id","catch","error","getMenu","params","userid","logout","dispatch","e","resetToken","changeRoles","role","root","accessRoutes","router","addRoutes","namespaced"],"mappings":";;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AAEA,IAAMA,KAAK,GAAG;AACZC,EAAAA,KAAK,EAAE,qBADK;AAEZC,EAAAA,IAAI,EAAE,EAFM;AAGZC,EAAAA,MAAM,EAAE,EAHI;AAIZC,EAAAA,YAAY,EAAE,EAJF;AAKZC,EAAAA,KAAK,EAAE,CAAC;AACNH,IAAAA,IAAI,EAAE;AADA,GAAD,CALK;AAQZI,EAAAA,QAAQ,EAAE,EARE;AASZC,EAAAA,QAAQ,EAAE;AATE,CAAd;AAYA,IAAMC,SAAS,GAAG;AAChBC,EAAAA,SAAS,EAAE,mBAACT,KAAD,EAAQC,KAAR,EAAkB;AAC3BD,IAAAA,KAAK,CAACC,KAAN,GAAcA,KAAd;AACD,GAHe;AAIhBS,EAAAA,gBAAgB,EAAE,0BAACV,KAAD,EAAQI,YAAR,EAAyB;AACzCJ,IAAAA,KAAK,CAACI,YAAN,GAAqBA,YAArB;AACD,GANe;AAOhBO,EAAAA,QAAQ,EAAE,kBAACX,KAAD,EAAQE,IAAR,EAAiB;AACzBF,IAAAA,KAAK,CAACE,IAAN,GAAaA,IAAb;AACD,GATe;AAUhBU,EAAAA,UAAU,EAAE,oBAACZ,KAAD,EAAQG,MAAR,EAAmB;AAC7BH,IAAAA,KAAK,CAACG,MAAN,GAAeA,MAAf;AACD,GAZe;AAahBU,EAAAA,SAAS,EAAE,mBAACb,KAAD,EAAQK,KAAR,EAAkB;AAC3BL,IAAAA,KAAK,CAACK,KAAN,GAAcA,KAAd;AACD,GAfe;AAgBhBS,EAAAA,YAAY,EAAE,sBAACd,KAAD,EAAQM,QAAR,EAAqB;AACjCN,IAAAA,KAAK,CAACM,QAAN,GAAiBA,QAAjB;AACD,GAlBe;AAmBhBS,EAAAA,YAAY,EAAE,sBAACf,KAAD,EAAQO,QAAR,EAAqB;AACjCP,IAAAA,KAAK,CAACO,QAAN,GAAiBA,QAAjB;AACD;AArBe,CAAlB;AAuBA,IAAMS,OAAO,GAAG;AACd;AACAC,EAAAA,KAFc,uBAEIX,QAFJ,EAEc;AAAA,QAApBY,MAAoB,QAApBA,MAAoB;AAAA,QAClBC,IADkB,GACOb,QADP,CAClBa,IADkB;AAAA,QACZC,QADY,GACOd,QADP,CACZc,QADY;AAAA,QACFC,IADE,GACOf,QADP,CACFe,IADE;AAE1B,WAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,uBAAM;AAAEL,QAAAA,IAAI,EAAEA,IAAI,CAACM,IAAL,EAAR;AAAqBL,QAAAA,QAAQ,EAAEA,QAA/B;AAAyCC,QAAAA,IAAI,EAAEA;AAA/C,OAAN,EAA6DK,IAA7D,CAAkE,UAAAC,QAAQ,EAAI;AAAA,YACpEC,IADoE,GAC3DD,QAD2D,CACpEC,IADoE;AAE5E;AACAC,QAAAA,OAAO,CAACC,GAAR,CAAYF,IAAZ;AACAV,QAAAA,MAAM,CAAC,WAAD,EAAcU,IAAI,CAAC3B,KAAnB,CAAN;AACAiB,QAAAA,MAAM,CAAC,cAAD,EAAiBU,IAAI,CAACG,IAAtB,CAAN;AACA,4BAASH,IAAI,CAAC3B,KAAd;AACA,6BAAU2B,IAAI,CAACG,IAAL,CAAUC,EAApB;AACAT,QAAAA,OAAO;AACR,OATD,EASGU,KATH,CASS,UAAAC,KAAK,EAAI;AAChBV,QAAAA,MAAM,CAACU,KAAD,CAAN;AACD,OAXD;AAYD,KAbM,CAAP;AAcD,GAlBa;AAoBd;AACAC,EAAAA,OArBc,0BAqBa;AAAA,QAAjBjB,MAAiB,SAAjBA,MAAiB;AAAA,QAATlB,KAAS,SAATA,KAAS;AACzB,WAAO,IAAIsB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,UAAMY,MAAM,GAAG;AACbC,QAAAA,MAAM,EAAErC,KAAK,CAACM,QAAN,IAAkBN,KAAK,CAACM,QAAN,CAAe0B;AAD5B,OAAf;AAGA,iCAAgBI,MAAhB,EAAwBV,IAAxB,CAA6B,UAAAC,QAAQ,EAAI;AACvC;AADuC,YAE/BC,IAF+B,GAEtBD,QAFsB,CAE/BC,IAF+B;AAGvCV,QAAAA,MAAM,CAAC,cAAD,EAAiBU,IAAjB,CAAN;AACAL,QAAAA,OAAO,CAACK,IAAD,CAAP;AACD,OALD,EAKGK,KALH,CAKS,UAAAC,KAAK,EAAI;AAChBV,QAAAA,MAAM,CAACU,KAAD,CAAN;AACD,OAPD;AAQD,KAZM,CAAP;AAaD,GAnCa;AAqCd;AACAI,EAAAA,MAtCc,yBAsCsB;AAAA,QAA3BpB,MAA2B,SAA3BA,MAA2B;AAAA,QAAnBlB,KAAmB,SAAnBA,KAAmB;AAAA,QAAZuC,QAAY,SAAZA,QAAY;AAClC,WAAO,IAAIjB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,UAAI;AACFN,QAAAA,MAAM,CAAC,WAAD,EAAc,EAAd,CAAN;AACAA,QAAAA,MAAM,CAAC,WAAD,EAAc,EAAd,CAAN;AACA;AACA;AACAK,QAAAA,OAAO;AACR,OAND,CAME,OAAOiB,CAAP,EAAU;AACVhB,QAAAA,MAAM,CAACgB,CAAD,CAAN;AACD;AACF,KAVM,CAAP;AAWD,GAlDa;AAoDd;AACAC,EAAAA,UArDc,6BAqDS;AAAA,QAAVvB,MAAU,SAAVA,MAAU;AACrB,WAAO,IAAII,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAC5BL,MAAAA,MAAM,CAAC,WAAD,EAAc,EAAd,CAAN;AACAA,MAAAA,MAAM,CAAC,WAAD,EAAc,EAAd,CAAN;AACA;AACAK,MAAAA,OAAO;AACR,KALM,CAAP;AAMD,GA5Da;AA8Dd;AACAmB,EAAAA,WA/Dc,8BA+DoBC,IA/DpB,EA+D0B;AAAA,QAA1BzB,MAA0B,SAA1BA,MAA0B;AAAA,QAAlBqB,QAAkB,SAAlBA,QAAkB;AACtC,WAAO,IAAIjB,OAAJ;AAAA,wFAAY,iBAAMC,OAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AACXtB,gBAAAA,KADW,GACH0C,IAAI,GAAG,QADJ;AAGjBzB,gBAAAA,MAAM,CAAC,WAAD,EAAcjB,KAAd,CAAN;AACA,oCAASA,KAAT;AAJiB;AAAA,uBAMOsC,QAAQ,CAAC,SAAD,CANf;;AAAA;AAAA;AAMTlC,gBAAAA,KANS,mBAMTA,KANS;AAQjB,2CARiB,CAUjB;;AAViB;AAAA,uBAWUkC,QAAQ,CAAC,2BAAD,EAA8BlC,KAA9B,EAAqC;AAAEuC,kBAAAA,IAAI,EAAE;AAAR,iBAArC,CAXlB;;AAAA;AAWXC,gBAAAA,YAXW;;AAajB;AACAC,gCAAOC,SAAP,CAAiBF,YAAjB,EAdiB,CAgBjB;;;AACAN,gBAAAA,QAAQ,CAAC,sBAAD,EAAyB,IAAzB,EAA+B;AAAEK,kBAAAA,IAAI,EAAE;AAAR,iBAA/B,CAAR;AAEArB,gBAAAA,OAAO;;AAnBU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAZ;;AAAA;AAAA;AAAA;AAAA,QAAP;AAqBD;AArFa,CAAhB;eAwFe;AACbyB,EAAAA,UAAU,EAAE,IADC;AAEbhD,EAAAA,KAAK,EAALA,KAFa;AAGbQ,EAAAA,SAAS,EAATA,SAHa;AAIbQ,EAAAA,OAAO,EAAPA;AAJa,C","sourcesContent":["import { login, getUserMenuList } from '@/api/user'\nimport { getToken, setToken, removeToken, setUserId } from '@/utils/auth'\nimport router, { resetRouter } from '@/router'\n\nconst state = {\n  token: getToken(),\n  name: '',\n  avatar: '',\n  introduction: '',\n  roles: [{\n    name: 'admin'\n  }],\n  userInfo: '',\n  menuList: []\n}\n\nconst mutations = {\n  SET_TOKEN: (state, token) => {\n    state.token = token\n  },\n  SET_INTRODUCTION: (state, introduction) => {\n    state.introduction = introduction\n  },\n  SET_NAME: (state, name) => {\n    state.name = name\n  },\n  SET_AVATAR: (state, avatar) => {\n    state.avatar = avatar\n  },\n  SET_ROLES: (state, roles) => {\n    state.roles = roles\n  },\n  SET_USERINFO: (state, userInfo) => {\n    state.userInfo = userInfo\n  },\n  SET_MENULIST: (state, menuList) => {\n    state.menuList = menuList\n  }\n}\nconst actions = {\n  // user login\n  login({ commit }, userInfo) {\n    const { dlbm, password, dwbm } = userInfo\n    return new Promise((resolve, reject) => {\n      login({ dlbm: dlbm.trim(), password: password, dwbm: dwbm }).then(response => {\n        const { data } = response\n        debugger\n        console.log(data)\n        commit('SET_TOKEN', data.token)\n        commit('SET_USERINFO', data.user)\n        setToken(data.token)\n        setUserId(data.user.id)\n        resolve()\n      }).catch(error => {\n        reject(error)\n      })\n    })\n  },\n\n  // get user menu\n  getMenu({ commit, state }) {\n    return new Promise((resolve, reject) => {\n      const params = {\n        userid: state.userInfo && state.userInfo.id\n      }\n      getUserMenuList(params).then(response => {\n        debugger\n        const { data } = response\n        commit('SET_MENULIST', data)\n        resolve(data)\n      }).catch(error => {\n        reject(error)\n      })\n    })\n  },\n\n  // user logout\n  logout({ commit, state, dispatch }) {\n    return new Promise((resolve, reject) => {\n      try {\n        commit('SET_TOKEN', '')\n        commit('SET_ROLES', [])\n        removeToken()\n        resetRouter()\n        resolve()\n      } catch (e) {\n        reject(e)\n      }\n    })\n  },\n\n  // remove token\n  resetToken({ commit }) {\n    return new Promise(resolve => {\n      commit('SET_TOKEN', '')\n      commit('SET_ROLES', [])\n      removeToken()\n      resolve()\n    })\n  },\n\n  // dynamically modify permissions\n  changeRoles({ commit, dispatch }, role) {\n    return new Promise(async resolve => {\n      const token = role + '-token'\n\n      commit('SET_TOKEN', token)\n      setToken(token)\n\n      const { roles } = await dispatch('getInfo')\n\n      resetRouter()\n\n      // generate accessible routes map based on roles\n      const accessRoutes = await dispatch('permission/generateRoutes', roles, { root: true })\n\n      // dynamically add accessible routes\n      router.addRoutes(accessRoutes)\n\n      // reset visited views and cached views\n      dispatch('tagsView/delAllViews', null, { root: true })\n\n      resolve()\n    })\n  }\n}\n\nexport default {\n  namespaced: true,\n  state,\n  mutations,\n  actions\n}\n"]}]}